<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>offline-plugin | Webpack Plugins</title>
    <meta name="generator" content="VuePress 1.5.0">
    <link rel="icon" href="/webpack-plugins-docs-cn/images/favicon.ico">
    <meta name="description" content="Webpack 除官网外的插件中文文档集，这里或许有你需要的。">
    <link rel="preload" href="/webpack-plugins-docs-cn/assets/css/0.styles.a0a44e73.css" as="style"><link rel="preload" href="/webpack-plugins-docs-cn/assets/js/app.c0a8bf5b.js" as="script"><link rel="preload" href="/webpack-plugins-docs-cn/assets/js/2.dbe3cc13.js" as="script"><link rel="preload" href="/webpack-plugins-docs-cn/assets/js/21.f9d5afc1.js" as="script"><link rel="preload" href="/webpack-plugins-docs-cn/assets/js/3.d4396c24.js" as="script"><link rel="prefetch" href="/webpack-plugins-docs-cn/assets/js/10.d844766f.js"><link rel="prefetch" href="/webpack-plugins-docs-cn/assets/js/11.f4eed091.js"><link rel="prefetch" href="/webpack-plugins-docs-cn/assets/js/12.7da9e2ae.js"><link rel="prefetch" href="/webpack-plugins-docs-cn/assets/js/13.244400be.js"><link rel="prefetch" href="/webpack-plugins-docs-cn/assets/js/14.dcbb64cf.js"><link rel="prefetch" href="/webpack-plugins-docs-cn/assets/js/15.53a9064f.js"><link rel="prefetch" href="/webpack-plugins-docs-cn/assets/js/16.69053e1a.js"><link rel="prefetch" href="/webpack-plugins-docs-cn/assets/js/17.48175a07.js"><link rel="prefetch" href="/webpack-plugins-docs-cn/assets/js/18.6e4065f5.js"><link rel="prefetch" href="/webpack-plugins-docs-cn/assets/js/19.2975bfd8.js"><link rel="prefetch" href="/webpack-plugins-docs-cn/assets/js/20.6956b3a5.js"><link rel="prefetch" href="/webpack-plugins-docs-cn/assets/js/22.144279a5.js"><link rel="prefetch" href="/webpack-plugins-docs-cn/assets/js/23.d1650269.js"><link rel="prefetch" href="/webpack-plugins-docs-cn/assets/js/24.c3a41084.js"><link rel="prefetch" href="/webpack-plugins-docs-cn/assets/js/25.b7e9b370.js"><link rel="prefetch" href="/webpack-plugins-docs-cn/assets/js/26.7b718c48.js"><link rel="prefetch" href="/webpack-plugins-docs-cn/assets/js/27.86d09141.js"><link rel="prefetch" href="/webpack-plugins-docs-cn/assets/js/28.a769f0ea.js"><link rel="prefetch" href="/webpack-plugins-docs-cn/assets/js/29.306cd6e2.js"><link rel="prefetch" href="/webpack-plugins-docs-cn/assets/js/30.3e08a357.js"><link rel="prefetch" href="/webpack-plugins-docs-cn/assets/js/31.20ca3fff.js"><link rel="prefetch" href="/webpack-plugins-docs-cn/assets/js/32.01e3d6c1.js"><link rel="prefetch" href="/webpack-plugins-docs-cn/assets/js/4.7351e2e0.js"><link rel="prefetch" href="/webpack-plugins-docs-cn/assets/js/5.01b4c584.js"><link rel="prefetch" href="/webpack-plugins-docs-cn/assets/js/6.37104416.js"><link rel="prefetch" href="/webpack-plugins-docs-cn/assets/js/7.2b03a32c.js"><link rel="prefetch" href="/webpack-plugins-docs-cn/assets/js/8.4073711c.js"><link rel="prefetch" href="/webpack-plugins-docs-cn/assets/js/9.0a841aa1.js">
    <link rel="stylesheet" href="/webpack-plugins-docs-cn/assets/css/0.styles.a0a44e73.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/webpack-plugins-docs-cn/" class="home-link router-link-active"><img src="/webpack-plugins-docs-cn/images/logo.png" alt="Webpack Plugins" class="logo"> <span class="site-name can-hide">Webpack Plugins</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="http://www.febeacon.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  大笑文档
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="/webpack-plugins-docs-cn/" class="nav-link">
  文档首页
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="http://www.febeacon.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  大笑文档
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="/webpack-plugins-docs-cn/" class="nav-link">
  文档首页
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/webpack-plugins-docs-cn/routes/" class="sidebar-link">目录</a></li><li><a href="/webpack-plugins-docs-cn/routes/webpack-build-notifier.html" class="sidebar-link">webpack-build-notifier</a></li><li><a href="/webpack-plugins-docs-cn/routes/friendly-errors-webpack-plugin.html" class="sidebar-link">friendly-errors-webpack-plugin</a></li><li><a href="/webpack-plugins-docs-cn/routes/webpack-jarvis.html" class="sidebar-link">webpack-jarvis</a></li><li><a href="/webpack-plugins-docs-cn/routes/copy-webpack-plugin.html" class="sidebar-link">copy-webpack-plugin</a></li><li><a href="/webpack-plugins-docs-cn/routes/write-file-webpack-plugin.html" class="sidebar-link">write-file-webpack-plugin</a></li><li><a href="/webpack-plugins-docs-cn/routes/prepack-webpack-plugin.html" class="sidebar-link">prepack-webpack-plugin</a></li><li><a href="/webpack-plugins-docs-cn/routes/offline-plugin.html" class="active sidebar-link">offline-plugin</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/webpack-plugins-docs-cn/routes/offline-plugin.html#安装" class="sidebar-link">安装</a></li><li class="sidebar-sub-header"><a href="/webpack-plugins-docs-cn/routes/offline-plugin.html#设置" class="sidebar-link">设置</a></li><li class="sidebar-sub-header"><a href="/webpack-plugins-docs-cn/routes/offline-plugin.html#文档" class="sidebar-link">文档</a></li></ul></li><li><a href="/webpack-plugins-docs-cn/routes/clean-webpack-plugin.html" class="sidebar-link">clean-webpack-plugin</a></li><li><a href="/webpack-plugins-docs-cn/routes/webpack-hook-plugin.html" class="sidebar-link">webpack-hook-plugin</a></li><li><a href="/webpack-plugins-docs-cn/routes/build-hash-webpack-plugin.html" class="sidebar-link">build-hash-webpack-plugin</a></li><li><a href="/webpack-plugins-docs-cn/routes/webpack-file-manager-plugin.html" class="sidebar-link">webpack-file-manager-plugin</a></li><li><a href="/webpack-plugins-docs-cn/routes/duplicate-package-checker-webpack-plugin.html" class="sidebar-link">duplicate-package-checker-webpack-plugin</a></li><li><a href="/webpack-plugins-docs-cn/routes/webpack-inject-plugin.html" class="sidebar-link">webpack-inject-plugin</a></li><li><a href="/webpack-plugins-docs-cn/routes/imagemin-webpack-plugin.html" class="sidebar-link">imagemin-webpack-plugin</a></li><li><a href="/webpack-plugins-docs-cn/routes/svg-sprite-webpack-plugin.html" class="sidebar-link">svg-sprite-webpack-plugin</a></li><li><a href="/webpack-plugins-docs-cn/routes/static-site-generator-webpack-plugin.html" class="sidebar-link">static-site-generator-webpack-plugin</a></li><li><a href="/webpack-plugins-docs-cn/routes/dynamic-cdn-webpack-plugin.html" class="sidebar-link">dynamic-cdn-webpack-plugin</a></li><li><a href="/webpack-plugins-docs-cn/routes/circular-dependency-plugin.html" class="sidebar-link">circular-dependency-plugin</a></li><li><a href="/webpack-plugins-docs-cn/routes/webpack-require-from.html" class="sidebar-link">webpack-require-from</a></li><li><a href="/webpack-plugins-docs-cn/routes/dynamic-vendor-webpack-plugin.html" class="sidebar-link">dynamic-vendor-webpack-plugin</a></li><li><a href="/webpack-plugins-docs-cn/routes/define-variable-webpack-plugin.html" class="sidebar-link">define-variable-webpack-plugin</a></li><li><a href="/webpack-plugins-docs-cn/routes/hook-shell-script-webpack-plugin.html" class="sidebar-link">hook-shell-script-webpack-plugin</a></li><li><a href="/webpack-plugins-docs-cn/routes/stylelint-webpack-plugin.html" class="sidebar-link">stylelint-webpack-plugin</a></li><li><a href="/webpack-plugins-docs-cn/routes/eslint-webpack-plugin.html" class="sidebar-link">eslint-webpack-plugin</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="offline-plugin">offline-plugin  <span class="badge tip" style="vertical-align:top;" data-v-76a02c50>v 5.0.7</span></h1> <p><a href="https://github.com/NekR/offline-plugin" target="_blank" rel="noopener noreferrer">插件的GitHub<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <img width="150" src="/webpack-plugins-docs-cn/images/offline_plugin_logo.png" style="vertical-align:middle;display:block;margin:0 auto;"> <p>本插件旨在为<code>webpack</code>项目提供离线体验。它利用了<code>ServiceWorker</code>和<code>AppCache</code>作为后台备份。只需要在您的<code>webpack.config.js</code>中引入这个插件，并在客户端脚本中包含相应的<code>runtime(运行时)</code>。通过缓存所有(或部分) <code>webpack</code>输出的资源，您的项目就可以离线了。</p> <h2 id="安装">安装</h2> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> offline-plugin <span class="token punctuation">[</span>--save-dev<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="设置">设置</h2> <p>首先，在您的<code>webpack.config.js</code>中实例化插件。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> OfflinePlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'offline-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>

  plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token comment">// ... 其他插件</span>
    <span class="token comment">// OfflinePlugin 是最后一个添加的比较好</span>
    <span class="token keyword">new</span> <span class="token class-name">OfflinePlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>然后，将<code>运行时(runtime)</code>添加到入口文件(通常是主入口)：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'offline-plugin/runtime'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">install</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>ES6/Babel/TypeScript</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> OfflinePluginRuntime <span class="token keyword">from</span> <span class="token string">'offline-plugin/runtime'</span><span class="token punctuation">;</span>
OfflinePluginRuntime<span class="token punctuation">.</span><span class="token function">install</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>下面示例展示如何设置配置项(TypeScript)：</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> OfflinePluginRuntime <span class="token keyword">from</span> <span class="token string">'offline-plugin/runtime'</span><span class="token punctuation">;</span>

OfflinePluginRuntime<span class="token punctuation">.</span><span class="token function">install</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function-variable function">onUpdateReady</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> OfflinePluginRuntime<span class="token punctuation">.</span><span class="token function">applyUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function-variable function">onUpdated</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> location<span class="token punctuation">.</span><span class="token function">reload</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>如果你需要手动解决<code>TypeScript</code>定义文件，那么你可以添加这一行到你的<code>ts</code>文件:</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token comment">/// &lt;reference path=&quot;node_modules/offline-plugin/runtime.d.ts&quot; /&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="文档">文档</h2> <h3 id="配置项-options">配置项(options)</h3> <p>这些配置项都是可选的，<a href="https://github.com/NekR/offline-plugin/blob/master/src/default-options.js" target="_blank" rel="noopener noreferrer">这里是默认设置<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <table><thead><tr><th style="text-align:center;">名称</th> <th style="text-align:center;">类型</th> <th style="text-align:center;">默认值</th> <th>描述</th></tr></thead> <tbody><tr><td style="text-align:center;">appShell</td> <td style="text-align:center;"><code>string</code></td> <td style="text-align:center;">null</td> <td>以<a href="https://developers.google.com/web/fundamentals/architecture/app-shell" target="_blank" rel="noopener noreferrer">app shell model<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>启动您的应用。可以设置为希望所有导航请求都返回的 HTML 文件。例如：<code>/app-shell.html</code>。后面会详述。</td></tr> <tr><td style="text-align:center;">responseStrategy</td> <td style="text-align:center;"><code>cache-first | network-first</code></td> <td style="text-align:center;"><code>cache-first</code></td> <td>若设置为<code>cache-first</code>，则所有的请求均优先检查缓存，如果缓存是空的，则请求网络。若使用<code>network-first</code>，所有请求首先发送到网络，如果网络请求失败，则查询缓存作为回退。</td></tr> <tr><td style="text-align:center;">externals</td> <td style="text-align:center;"><code>Array&lt;string&gt;</code></td> <td style="text-align:center;">null</td> <td>指定要缓存的其他(构建过程中的外部)URL. <br> 例如：<code>['/static/img/media.png', 'https://fonts.googleapis.com/css?family=Roboto']</code></td></tr> <tr><td style="text-align:center;">excludes</td> <td style="text-align:center;"><code>Array&lt;string | globs_pattern&gt;</code></td> <td style="text-align:center;"><code>['**/.*', '**/*.map', '**/*.gz']</code></td> <td>将哪些文件排除出缓存。以<code>.</code>开头和以<code>.map</code>或<code>.gz</code>为结尾的文件则被排除在外。<br> ⚠️注意：该项是在<code>rewrites</code>之前起作用的。</td></tr> <tr><td style="text-align:center;">autoUpdate</td> <td style="text-align:center;"><code>true | number</code></td> <td style="text-align:center;"><code>false</code></td> <td>启用 ServiceWorker 和 AppCache 的自动更新。如果设置为<code>true</code>，则默认<strong>1小时</strong>间隔。我们可以传入数字来自定义更新间隔。<br> 请注意：如果用户在您的网站上打开了多个标签，那么更新可能发生的更频繁，因为每个打开的标签都有自己的更新间隔。 <br><br> 示例：<code>true</code> <br> 示例：<code>1000 * 60 * 60 * 5</code>(五小时)</td></tr> <tr><td style="text-align:center;">relativePaths</td> <td style="text-align:center;"><code>boolean</code></td> <td style="text-align:center;"><code>true</code></td> <td>当设置为<code>true</code>时，缓存中生成的所有路径是分别相对于 ServiceWorker 文件或 AppCache 文件夹位置。 <br><br> 当设置了<code>publicPath</code>时，该项被忽略。而当该项设置为<code>true</code>时，则是<code>publicPath</code>被忽略。</td></tr> <tr><td style="text-align:center;">rewrites</td> <td style="text-align:center;"><code>Function | Object</code></td> <td style="text-align:center;">Rewrite <code>/index.html</code> to <code>/</code></td> <td>提供一种更改加载资源URL的方式。当资源与客户期望有差异时，就需要它出场了。比方说CDN。后面会详述。</td></tr> <tr><td style="text-align:center;">cacheMaps</td> <td style="text-align:center;"><code>Array&lt;Object&gt;</code></td> <td style="text-align:center;"></td> <td>后面会详述。</td></tr> <tr><td style="text-align:center;">ServiceWorker</td> <td style="text-align:center;"><code>Object | null | false</code></td> <td style="text-align:center;"></td> <td>内容表格放不下，后面详述。</td></tr> <tr><td style="text-align:center;">publicPath</td> <td style="text-align:center;"><code>string</code></td> <td style="text-align:center;"></td> <td>和<code>webpack</code>的<code>output.publicPath</code>配置项类似。专门为 offline-plugin 指定或覆盖<code>publicPath</code>时非常有用。当未设置时，使用<code>webpack</code>的<code>output.publicPath</code>。当完全没有指定<code>publicPath</code>值时(无论是通过这个选项还是通过<code>webpack</code>的输出)，使用相对路径(参见<code>relativePaths</code>)。<br><br> 示例：<code>publicPath: /project/</code> <br> 示例：<code>publicPath: 'https://example.com/project'</code></td></tr> <tr><td style="text-align:center;">version</td> <td style="text-align:center;"><code>string | (plugin: OfflinePlugin) =&gt; void</code></td> <td style="text-align:center;">当前时间和日期</td> <td>缓存的版本。可以是函数，这在需要应用动态值的观察模式下非常有用。 <br><br> · 若是函数，则在调用时将插件实例作为第一个参数。 <br> · 若是字符串，可以插入<code>[hash]</code>标记。 <br><br> 示例：<code>2018-6-20 09:53:56</code> <br> 请注意如果您使用了默认值(date和time)，那么 service worker 的版本会在您每次构建项目时改变。</td></tr> <tr><td style="text-align:center;">caches</td> <td style="text-align:center;"><code>'all' | Object</code></td> <td style="text-align:center;"><code>'all'</code></td> <td>允许您调整缓存资源的内容和方式. <br><br> · <code>'all'</code>：意味着在外部配置项中列出的所有项目(所有<code>webpack</code>输出资产)和<code>URL</code>都将在安装时缓存。 <br> · <code>Object</code>：对象有三个可能的<code>Array&lt;string | RegExp&gt;</code>字段：<code>main</code>、<code>additional</code>、<code>optional</code>。所有的字段都是可选且默认为空的。更多内容后面详述。</td></tr> <tr><td style="text-align:center;">AppCache</td> <td style="text-align:center;"><code>Object | null | false</code></td> <td style="text-align:center;"></td> <td>设置<code>AppCache</code>缓存的设置。设置为<code>null</code>或<code>false</code>则禁用<code>AppCache</code>生成。更多内容后面详述。</td></tr> <tr><td style="text-align:center;">updateStrategy</td> <td style="text-align:center;"><code>'changed' | 'all'</code></td> <td style="text-align:center;"><code>'changed'</code></td> <td>缓存更新策略。<strong>请不要更改此选项，除非您确信您知道自己在做什么。</strong> 后面也有详述。</td></tr></tbody></table> <h3 id="配置项详述部分"><strong>配置项详述部分</strong></h3> <p><strong><code>appShell: string</code></strong></p> <blockquote><p>默认：<code>null</code>
示例：&quot;/&quot;</p></blockquote> <p>在制作单页应用时，通常使用<a href="https://developers.google.com/web/fundamentals/architecture/app-shell" target="_blank" rel="noopener noreferrer">app shell model<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>模式。</p> <p>为了让<code>offline-plugin</code>将所有位置的导航请求重定向到特定的缓存，我们可以配置<code>appShell</code>项，比方说:<code>appShell: '/'</code></p> <h4 id="ssr">SSR</h4> <p>当使用<code>AppShell</code>模型进行服务端渲染时，请确保不会缓存任何服务端渲染的数据。其中最简单的方法是创建一个没有任何服务端渲染数据的HTML文件路由并进行缓存。例如：<code>appShell: '/app-shell.html'</code></p> <h4 id="advanced">Advanced</h4> <p><code>appShell</code>是<code>cacheMaps</code>项为<code>ServiceWorker</code>准备的，而<code>AppCache.FallBack</code>则对应<code>AppCache</code>。</p> <p><strong><code>rewrites</code></strong></p> <p>该回调将迭代<code>assets</code>和由插件生成的serviceWorker文件中的<code>external</code>数组。这可以帮助开发人员根据场景修改资源，比如为多个资源设置多个 CDN。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function-variable function">rewrites</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">asset</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>	
    <span class="token keyword">if</span> <span class="token punctuation">(</span>asset<span class="token punctuation">.</span><span class="token function">endsWith</span><span class="token punctuation">(</span><span class="token string">'html'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">'https://www.qq.com/'</span> <span class="token operator">+</span> asset<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">'https://s1.url.cn/'</span> <span class="token operator">+</span> asset<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> asset<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p><strong><code>cacheMaps</code></strong></p> <p>该项允许将请求重定向到缓存或另一个请求。假设您正在使用<a href="https://medium.com/google-developers/instant-loading-web-apps-with-an-application-shell-architecture-7c0c2f10c73" target="_blank" rel="noopener noreferrer">App-Shell模式<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>开发您的网站，并且使用您的 app-shell 缓存首页<code>/</code>。现在当用户访问<code>/something-else</code>时，我们需要从缓存中提供相同的 app-shell。通过<code>cacheMaps</code>可以轻松办到：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">new</span> <span class="token class-name">OfflinePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    cacheMaps<span class="token punctuation">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            <span class="token function-variable function">match</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">requestUrl</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">URL</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> location<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            requestTypes<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'navigate'</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>注意，这个功能是通过<a href="https://github.com/NekR/offline-plugin/blob/master/docs/app-shell.md" target="_blank" rel="noopener noreferrer">appShell<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>配置项实现的，所以如果没有更复杂需求的话，您应该更喜欢它。</p> <p>可用的属性：</p> <ul><li><code>match</code>: string | RegExp | function -- 匹配 URL 以映射到缓存。如果是函数，那么它接受2个参数：请求的<code>URL</code>对象以及<code>Request</code>本身。函数的返回值作为新的<code>URL</code>。它<strong>必须</strong>是一个<code>URL</code>对象。</li> <li><code>to</code>: string | function -- 仅当<code>match</code>不是函数时使用。每个 URL 都和<code>urlString.replace(map.match, map.to)</code>相匹配，因此<code>to</code>配置项实际是请求url时调用的<code>String.replace</code>函数的第二个参数。</li> <li><code>requestType</code> Array -- 此次映射应当使用的请求类型数组。可以是任何值的组合: <code>navigare</code>、<code>same-origin</code>、<code>cross-origin</code>。示例：<code>requestTypes: ['navigate', 'same-origin']</code></li></ul> <p><strong><code>Caches</code></strong></p> <p><code>caches: 'all' | Object</code></p> <p>告诉插件哪些需要缓存及如何缓存。</p> <ul><li><code>'all'</code>：意味着在外部配置项中列出的所有项目(所有<code>webpack</code>输出资产)和<code>URL</code>都将在安装时缓存。</li> <li><code>Object</code>：对象有三个可能的<code>Array&lt;string | RegExp&gt;</code>字段：<code>main</code>、<code>additional</code>、<code>optional</code>。所有的字段都是可选且默认为空的。</li></ul> <p><strong>高级用法</strong></p> <p>传递<code>Object</code>以自定义构建资源的方法。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>caches<span class="token punctuation">:</span> <span class="token punctuation">{</span>
  main<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">':rest:'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  additional<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">':externals:'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  optional<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'*.chunk.js'</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>在这个例子中，以<code>chunk.js</code>结尾的资源被列入<code>optional</code>缓存中，外部资源则归为<code>additional</code>缓存，其余的则列为<code>main</code>缓存。</p> <p>特殊关键字<code>:rest</code>来匹配所有<code>未使用/未缓存</code>的静态资源。若要匹配多个资源或动态名称的资源，请使用<a href="https://www.npmjs.com/package/minimatch" target="_blank" rel="noopener noreferrer">模式匹配<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。若添加(不属于<code>webpack</code>构建流程内的)外部资源，请在<code>externals</code>中列出它们，然后再缓存中使用<code>:externals</code>关键字。如果你不想把所有<code>externals</code>都放到同一个部分，那么可以单独列出(示例：<code>additional: ['/external.js']</code>)而非使用<code>:externals</code>关键字。</p> <p><strong>Cache sections</strong></p> <ul><li><code>main</code>: 首先缓存这部分列出的资源(<code>ServiceWorker</code>的<code>install</code>事件)，如果这部分缓存失败————则不会缓存任何资源。因此，这里应包含最重要的资源(如：<code>['index.html', 'main.js']</code>)，没这些网站就歇菜的那种。</li> <li><code>additional</code>: <strong>默认情况下仅在 <code>ServiceWorker</code> 中启用</strong>。该部分的资源是在<code>main</code>部分成功加载之后才加载的(<code>ServiceWorks</code>的<code>activate</code>事件)。如果有任何资源加载失败，则不会从本部分缓存任何内容，并且所有资源都会被移动到<code>optional</code>部分。如果更改了<strong>当前更新策略</strong>，则下载失败的资源会被移动到<code>optional</code>部分，所有其他的资源则成功缓存。</li> <li><code>optional</code>: <strong>默认情况下仅在 <code>ServiceWorker</code> 中启用</strong>。只有从服务器时才缓存的资源。<code>ServiceWorker</code>不会提前下载。</li></ul> <blockquote><p>注意：AppCache 不支持有条件或延迟的资源加载，默认情况下忽略<code>additional</code>和<code>optional</code>部分中的资源。要使AppCache缓存所有部分，请设置此选项:</p></blockquote> <div class="language-js line-numbers-mode"><pre class="language-js"><code>AppCache<span class="token punctuation">:</span> <span class="token punctuation">{</span>
  caches<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'main'</span><span class="token punctuation">,</span> <span class="token string">'additional'</span><span class="token punctuation">,</span> <span class="token string">'optional'</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><strong><code>ServiceWorker: Object | null | false</code></strong></p> <p>设置<code>ServiceWorker</code>的缓存。设置<code>null</code>和<code>false</code>可以禁用<code>ServiceWorker</code>。</p> <ul><li><strong><code>output</code></strong>: <code>string</code>。配发脚本的相对输出路径(<code>webpack</code>配置中的<code>output.path</code>)。 默认：<code>'sw.js'</code></li> <li><strong><code>entry</code></strong>: <code>string</code>。作为<code>ServiceWorker</code>入口/引导文件的相对或绝对路径。对于实现<code>ServiceWorker</code>事件的额外功能和句柄如<code>push</code>、<code>sync</code>等非常有用。默认：<code>空文件</code>.</li> <li><strong><code>scope</code></strong>: <code>string</code>。<strong>该项十分危险！</strong>。在将<code>ServiceWorker</code>部署到生产环境后，不应该更改此选项。更改它可能会损坏缓存，并在用户的设备上留下旧的缓存。当需要在同一域中运行多个项目时，此选项非常有用。默认：<code>''</code>。示例：<code>'my-project'</code>。</li> <li><strong><code>events</code></strong>: <code>boolean</code>。为<code>ServiceWorker</code>启用运行时事件。有关受支持的事件，请参阅<a href="https://github.com/NekR/offline-plugin/blob/master/docs/runtime.md" target="_blank" rel="noopener noreferrer">运行时<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>的<code>install()</code>选项。默认值：<code>false</code></li> <li><strong><code>publicPath</code></strong>: <code>string</code>。提供一种覆盖服务器上<code>ServiceWorker</code>脚本文件位置的方式。应该是生成<code>ServiceWorker</code>的确切路径。默认：<code>null</code>。示例：<code>'/my/new/path/sw.js'</code></li> <li><strong><code>navigationPreload</code></strong>: <code>boolean | Object | ':auto'</code>. 参见<a href="https://github.com/NekR/offline-plugin/blob/master/docs/navigation-preload.md" target="_blank" rel="noopener noreferrer">ServiceWorker.navigationPreload<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，默认：<code>auto</code></li> <li><strong><code>prefetchRequest</code></strong>: <code>Object</code>。为预请求提供一种可以指定<a href="https://developer.mozilla.org/en-US/docs/Web/API/Request/Request" target="_blank" rel="noopener noreferrer">请求初始配置项<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>的方式(在<code>install</code>事件中的预缓存请求。)。可选值：<code>credentials</code>、<code>headers</code>、<code>mode</code>、<code>cache</code>。默认: <code>{ credentials: 'omit', mode: 'cors' }</code>。示例：<code>{ credentials: 'include' }</code></li> <li><strong><code>minify</code></strong>：<code>boolean</code>。 如果设置为<code>true</code>或<code>false</code>, <code>ServiceWorker</code>的输出将相应地压缩或不压缩。如果您使用了<code>webpack.optimization.UglifyJsPlugin</code>或<code>terser-webpack-plugin</code>的话，设置为其他值，<code>ServiceWorker</code>输出将被压缩，。默认值：<code>null</code>。</li></ul> <p><strong><code>runtime(运行时)</code></strong></p> <p><strong>install(options: Object)</strong></p> <p>开始<code>ServiceWorker</code>/<code>AppCache</code>的安装流。它虽然安全，但每次你的页面加载时都会调用(不要把它包装到任何条件中)。</p> <p><strong>applyUpdate()</strong></p> <p>用于为现有安装应用更新。参见下面的<code>install</code>配置项。</p> <p><strong>update()</strong></p> <p>检查新<code>ServiceWorker/AppCache</code>的更新。</p> <p><strong>install()的配置项(options)</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> OfflinePluginRuntime <span class="token keyword">from</span> <span class="token string">'offline-plugin/runtime'</span><span class="token punctuation">;</span>
OfflinePluginRuntime<span class="token punctuation">.</span><span class="token function">install</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function-variable function">onInstalled</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">// 事件在安装 ServiceWorker 或 AppCache 时被调用一次。可用于显示“App已准备好脱机使用”消息。</span>
  <span class="token function-variable function">onUpdating</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">// AppCache 不支持这一事件。当发现更新并且浏览器开始更新进程时调用。此时，一些资源正在下载。</span>
  <span class="token function-variable function">onUpdateReady</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">// 当 onupdating 阶段完成时调用。此时所有必需的资源都已下载并准备好进行更新。调用 runtime.applyUpdate() 来应用更新。</span>
  <span class="token function-variable function">onUpdateFailed</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">// 当 onupdating 阶段因某种原因失败时调用。此时没有下载任何东西，您的代码中的当前更新过程应该被取消或忽略。</span>
  <span class="token function-variable function">onUpdated</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token comment">// 当应用更新时，通过调用 runtime.applyUpdate() 或浏览器本身的其他方式调用。</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/webpack-plugins-docs-cn/routes/prepack-webpack-plugin.html" class="prev">
        prepack-webpack-plugin
      </a></span> <span class="next"><a href="/webpack-plugins-docs-cn/routes/clean-webpack-plugin.html">
        clean-webpack-plugin
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/webpack-plugins-docs-cn/assets/js/app.c0a8bf5b.js" defer></script><script src="/webpack-plugins-docs-cn/assets/js/2.dbe3cc13.js" defer></script><script src="/webpack-plugins-docs-cn/assets/js/21.f9d5afc1.js" defer></script><script src="/webpack-plugins-docs-cn/assets/js/3.d4396c24.js" defer></script>
  </body>
</html>
